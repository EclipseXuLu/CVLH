<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image Classification With Deep Convolutional Neural Networks</title>
    <link rel="stylesheet" href="../css/img-classify.css">
    <link rel="stylesheet" href="../bootstrap-4.0.0-alpha.5-dist/css/bootstrap.css">
    <script src="../js/jquery-3.1.1.min.js"></script>
    <script src="../bootstrap-4.0.0-alpha.5-dist/js/bootstrapv3.min.js"></script>
    <link rel="stylesheet" href="../css/common.css">
</head>
<script type="text/javascript">
    $(document).ready(
        function () {
            String.prototype.evalJSON = function () {
                return eval('(' + this + ')');
            }
            $('#classifyfile').attr('disabled', true);
            $('#imagefile').change(
                function () {
                    if ($(this).val()) {
                        var formdata = new FormData($('#formupload')[0]);
                        $.ajax({
                            url: "/api/hzau/image/classify",
                            type: "POST",
                            contentType: false,
                            processData: false,
                            data: formdata,
                            success: function (data) {
                                var obj = data.evalJSON();
                                console.log(obj);
                                if (obj.status == 0) {
                                    $(".media-object").attr("src", obj.data.imgSrc);
                                    $(".media").show();
                                    var html = gethtmlbyObj(obj.data.result.precision);
                                    var html1 = gethtmlbyObj(obj.data.result.recall);
                                    $("#infopred ul").html(html);
                                    $("#flatpred ul").html(html1);
                                    $('.ctimes').text(obj.data.time);
                                }
                            },
                            error: function (data) {
                                $('#serverResponse').html(data.status + " : " + data.statusText + " : " + data.responseText);
                            }
                        });
                    }
                }
            );

        }
    );

    function classifyUrl() {
        $.ajax({
            url: "/api/hzau/image/url",
            type: "POST",
            data: {url: $("#imageurl").val().trim()},
            success: function (data) {
                var obj = data.evalJSON();
                console.log(obj);
                if (obj.status == 0) {
                    $(".media-object").attr("src", obj.data.imgSrc);
                    $(".media").show();
                    var html = gethtmlbyObj(obj.data.result.precision);
                    var html1 = gethtmlbyObj(obj.data.result.recall);
                    $("#infopred ul").html(html);
                    $("#flatpred ul").html(html1);
                    $('.ctimes').text(obj.data.time);
                }
            },
            error: function (data) {
                $('#serverResponse').html(data.status + " : " + data.statusText + " : " + data.responseText);
            }
        })
    }

    function gethtmlbyObj(obj) {
        var html = "";
        for (var key in obj) {
            html += '<li class="list-group-item"><span class="badge">' + obj[key] +
                '</span><h4 class="list-group-item-heading">' +
                '<a href="https://www.baidu.com/s?wd=' + key + '" target="_blank">' + key + '</a></h4></li>';
        }
        return html;
    }
</script>
<body>
<!-- Begin page content -->
<div class="container">
    <div class="page-header">
        <h1><a href="/">Image Classification Online</a></h1>
        <p>
            Large scale image classification based on deep convolutional neural networks powered by <a href="https://deeplearning4j.org/">deeplearning4j</a>.
        </p>
    </div>

    <div>
        <h2>Classification</h2>
    </div>
    <!--RETURN RESULT BEGIN-->
    <div class="media" style="display: none">
        <a class="pull-left" href="#"><img class="media-object" width="192" height="192"></a>
        <div class="media-body">
            <div class="bs-example bs-example-tabs">
                <ul id="myTab" class="nav nav-tabs">
                    <li class="active"><a href="#infopred" data-toggle="tab">Maximally accurate</a></li>
                    <li><a href="#flatpred" data-toggle="tab">Maximally specific</a></li>
                </ul>
                <div id="myTabContent" class="tab-content">
                    <div class="tab-pane fade in active" id="infopred">
                        <ul class="list-group">
                        </ul>
                    </div>
                    <div class="tab-pane fade" id="flatpred">
                        <ul class="list-group">
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <!--RETURN RESULT END-->
    <p> CNN took <span class="ctimes">0</span> seconds. </p>
    <hr>


    <form>
        <div class="form-group">
            <div class="input-group">
                <input type="text" class="form-control" name="imageurl" id="imageurl" placeholder="Provide an image URL">
                <span class="input-group-btn">
              <input class="btn btn-primary" value="Classify URL" id="classifyurl" onclick="classifyUrl()">
            </span>
            </div><!-- /input-group -->
        </div>
    </form>

    <form id="formupload" class="form-inline" action="/api/hzau/image/classifier" method="post" enctype="multipart/form-data">
        <div class="form-group">
            <label for="imagefile">Or upload an image:</label>
            <div for="file-uploader" class="upload-img"><i class="icons icon-upload"></i><span>本地上传</span>
                <input type="file" name="file" id="imagefile" class="file-uploader-one">
            </div>
        </div>
        <!--<input type="submit" class="btn btn-primary" value="Classify File" id="classifyfile"></input>-->
    </form>
</div>

<hr>
<footer id="footer" class="footer hidden-print">
    Copyright &copy; 2017 Computer Vision Lab of HZAU
</footer>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Face Compare</title>
    <link rel="stylesheet" href="/static/css/face-compare.css">
    <link rel="stylesheet" href="/static/css/bootstrapValidator.css">
    <link rel="icon" href="/static/res/favicon.ico">
    <style>
        h2 {
            font-family: Times, serif;
        }

        .footer-box a {
            color: #dadada;
            text-decoration: none;
        }
    </style>
</head>
<body>
<div class="container comparing-page">
    <div id="demo" class="compare-demo-page">
        <h2>Face Compare</h2>
        <p>Face comparing based on FaceNet algorithm</p>
        <div class="compare-box">
            <div class="handle-img first">
                <div class="img-box img-box-one"><img id="img-one" src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/left_pic_one.jpg">
                    <div class="face-border face-border-one" style="width:500px; height:500px; top:50%; left:50%; margin-left:-250px; margin-top:-250px;">
                        <div class="landmarkBox" style="width: 264px; height:264px; left: 125px; top: 211px;"></div>
                    </div>
                </div>
                <div class="search-box">
                    <form class="search-box1" method="post" enctype="multipart/form-data">
                        <lable for="file-uploader" class="upload-img"><i class="icons icon-upload"></i><span>Upload</span>
                            <input type="file" name="file" accept="image/png,image/jpeg" id="file-uploader1" onchange="uploadimg(1,'img-box-one')" class="file-uploader-one">
                        </lable>
                    </form>
                    <button onclick="detectUrl('search-input-one')" class="search-btn search-btn-one">Detect</button>
                    <input placeholder="Image URL" class="search-input search-input-one">
                </div>
                <div class="swiper-box">
                    <div class="swiper-container swiper-container-one swiper-container-horizontal">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide swiper-slide-active" style="width: 88px;">
                                <div data-image="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/left_pic_one.jpg"
                                     class="slide-img-box slide-img-box-one img-active-one"><img
                                        src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/left_pic_one.jpg" alt="demo"></div>
                            </div>
                            <div class="swiper-slide swiper-slide-next" style="width: 88px;">
                                <div data-image="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/left_pic_two.jpg"
                                     class="slide-img-box slide-img-box-one"><img
                                        src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/left_pic_two.jpg" alt="demo"></div>
                            </div>
                            <div class="swiper-slide" style="width: 88px;">
                                <div data-image="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/left_pic_three.jpg"
                                     class="slide-img-box slide-img-box-one"><img
                                        src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/left_pic_three.jpg" alt="demo"></div>
                            </div>
                            <div class="swiper-slide" style="width: 88px;">
                                <div data-image="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/left_pic_four.jpg"
                                     class="slide-img-box slide-img-box-one"><img
                                        src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/left_pic_four.jpg" alt="demo"></div>
                            </div>
                            <div class="swiper-slide" style="width: 88px;">
                                <div data-image="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/left_pic_five.jpg"
                                     class="slide-img-box slide-img-box-one"><img
                                        src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/left_pic_five.jpg" alt="demo"></div>
                            </div>
                            <div class="swiper-slide" style="width: 88px;">
                                <div data-image="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/left_pic_six.jpg"
                                     class="slide-img-box slide-img-box-one"><img
                                        src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/left_pic_six.jpg" alt="demo"></div>
                            </div>
                        </div>
                        <div class="swiper-button-prev swiper-button-prev-one swiper-button-disabled">
                            <div class="icons icon-swiper-left-small"></div>
                        </div>
                        <div class="swiper-button-next swiper-button-next-one">
                            <div class="icons icon-swiper-right-small"></div>
                        </div>
                    </div>
                </div>
                <div class="compare-result result-box">
                    <h2>Comparing Result</h2>
                    <p class="result-desc">Are they the same person: Very likely</p></div>
            </div>
            <div class="handle-img">
                <div class="img-box-two img-box"><img id="img-two" src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/right_pic_one.jpg">
                    <div class="face-border face-border-two" style="width:500px; height:500px; top:50%; left:50%; margin-left:-250px; margin-top:-250px;">
                        <div class="landmarkBox" style=" width: 260px; height:260px; left: 133px; top: 215px;"></div>
                    </div>
                </div>
                <div class="search-box">
                    <form class="search-box2" method="post" enctype="multipart/form-data">
                        <lable for="file-uploader" class="upload-img"><i class="icons icon-upload"></i><span>Upload</span>
                            <input type="file" name="file" accept="image/png,image/jpeg" id="file-uploader2" onchange="uploadimg(2,'img-box-two')" class="file-uploader-two">
                        </lable>
                    </form>
                    <button onclick="detectUrl('search-input-two')" class="search-btn search-btn-two">Detect</button>
                    <input placeholder="Image URL" class="search-input search-input-two">
                </div>
                <div class="swiper-box">
                    <div class="swiper-container swiper-container-two swiper-container-horizontal">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide swiper-slide-active" style="width: 88px;">
                                <div data-image="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/right_pic_one.jpg"
                                     class="slide-img-box slide-img-box-two img-active-two"><img
                                        src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/right_pic_one.jpg" alt="demo"></div>
                            </div>
                            <div class="swiper-slide swiper-slide-next" style="width: 88px;">
                                <div data-image="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/right_pic_two.jpg"
                                     class="slide-img-box slide-img-box-two"><img
                                        src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/right_pic_two.jpg" alt="demo"></div>
                            </div>
                            <div class="swiper-slide" style="width: 88px;">
                                <div data-image="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/right_pic_three.jpg"
                                     class="slide-img-box slide-img-box-two"><img
                                        src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/right_pic_three.jpg" alt="demo"></div>
                            </div>
                            <div class="swiper-slide" style="width: 88px;">
                                <div data-image="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/right_pic_four.jpg"
                                     class="slide-img-box slide-img-box-two"><img
                                        src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/right_pic_four.jpg" alt="demo"></div>
                            </div>
                            <div class="swiper-slide" style="width: 88px;">
                                <div data-image="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/right_pic_five.jpg"
                                     class="slide-img-box slide-img-box-two"><img
                                        src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/right_pic_five.jpg" alt="demo"></div>
                            </div>
                            <div class="swiper-slide" style="width: 88px;">
                                <div data-image="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/right_pic_six.jpg"
                                     class="slide-img-box slide-img-box-two"><img
                                        src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/comparing/right_pic_six.jpg" alt="demo"></div>
                            </div>
                        </div>
                        <div class="swiper-button-prev swiper-button-prev-two swiper-button-disabled">
                            <div class="icons icon-swiper-left-small"></div>
                        </div>
                        <div class="swiper-button-next swiper-button-next-two">
                            <div class="icons icon-swiper-right-small"></div>
                        </div>
                    </div>
                </div>
                <div class="response-json result-box">
                    <h2>Response JSON</h2>
                    <textarea readonly="" cols="30" rows="10" class="resp-json-container">{
  "faces1": [
    {
      "face_rectangle": {
        "width": 264,
        "top": 211,
        "left": 125,
        "height": 264
      },
      "face_token": "6d7bb3faa7f5c2a960e8f32642ea0118"
    }
  ],
  "faces2": [
    {
      "face_rectangle": {
        "width": 260,
        "top": 215,
        "left": 133,
        "height": 260
      },
      "face_token": "8fd4582254235948dd334df6bdbafa05"
    }
  ],
  "time_used": 641,
  "thresholds": {
    "1e-3": 62.327,
    "1e-5": 73.975,
    "1e-4": 69.101
  },
  "confidence": 88.508,
  "image_id2": "SPedNTNWqgPmupahuTaSZQ==",
  "image_id1": "uADw4RAdkIsQxhaDMwiqig==",
  "request_id": "1502633782,f0f30b82-15aa-405a-bd4f-a8bcd135eab7"
}</textarea>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="footer-box">© 2017 <a href="index.html">CVLH</a></div>
<script src="/static/js/jquery-3.1.1.min.js" type="text/javascript"></script>
<script src="/static/bootstrap-4.0.0-alpha.5-dist/js/bootstrap.js" type="text/javascript"></script>
<script src="/static/js/bootstrapValidator.js" type="text/javascript"></script>
<script src="/static/js/layer/layer.js" type="text/javascript"></script>
<script type="text/javascript">
    String.prototype.evalJSON = function () {
        return eval('(' + this + ')');
    }

    function uploadimg(i, pclass) {
        var obj = $("#file-uploader" + i), formobj = $(".search-box" + i);
        if (obj.val()) {
            var formdata = new FormData(formobj[0]);
            $.ajax({
                url: "/api/hzau/face/upthendetect",
                type: "POST",
                contentType: false,
                processData: false,
                data: formdata,
                success: function (data) {
                    var obj = data.evalJSON();
                    debugger
                    $("." + pclass + " img").attr("src", obj.data.src);
                    var sunobj = obj.data.faces.face1;
                    $("." + pclass + " .face-border").css({'width': $("." + pclass + " img").width(), 'height': $("." + pclass + " img").height()})
                    $("." + pclass + " .landmarkBox").css({'left': 250 - sunobj.width / 2, 'top': sunobj.y, 'width': sunobj.width, 'height': sunobj.height})
                    /*for(i=0;i<obj.data.face_number;i++){
//                            var sunobj=obj.faces[face+];
                        $("."+pclass+" .landmarkBox").css({'left':sunobj.x,'top':sunobj.y,'width':sunobj.x})
                    }*/
                    /*if (obj.status == 0) {
                    }*/
                },
                error: function (data) {
                    $('#serverResponse').html(data.status + " : " + data.statusText + " : " + data.responseText);
                }
            });
        }
        /* switch (i) {
             case 1:
                 // ...
                 break;
             case 2:
                 // ...
                 break;
         }*/
    }

    function detectUrl(c) {
        if ($(".c").val().trim() != "") {
            $.ajax({
                url: "/api/hzau/image/url",
                type: "POST",
                data: {url: $("#imageurl").val().trim()},
                success: function (data) {
                    var obj = data.evalJSON();
                    if (obj.status == 0) {
                        $(".media-object").attr("src", obj.data.imgSrc);
                        $(".media").show();
                        var html = gethtmlbyObj(obj.data.result.precision);
                        var html1 = gethtmlbyObj(obj.data.result.recall);
                        $("#infopred ul").html(html);
                        $("#flatpred ul").html(html1);
                        $('.ctimes').text(obj.data.time);
                    }
                },
                error: function (data) {
                    $('#serverResponse').html(data.status + " : " + data.statusText + " : " + data.responseText);
                }
            })
        } else {
            layer.msg('invalid url');
        }
    }

    $(function () {
        $('#urlsubmit')
            .bootstrapValidator({
                fields: {
                    imageurl: {
                        validators: {
                            notEmpty: {
                                message: 'Invalid Image URL'
                            }
                        }
                    },
                }
            }).on('error.form.bv',
            function (e) {
                var $form = $(e.target), validator = $form.data('bootstrapValidator'),
                    $invalidField = validator.getInvalidFields().eq(0), $collapse = $invalidField.parents('.collapse');
                $collapse.collapse('show');
            });
    })
</script>
</body>
</html>